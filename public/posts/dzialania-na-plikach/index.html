<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=56746&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>DziaÅ‚ania na plikach | Pawel Wiejkut</title>
<meta name="keywords" content="ABAP, ABAP od podstaw">
<meta name="description" content="Potrafimy juÅ¼ tworzyÄ‡ podstawowe struktury danych, wiemy teÅ¼ jak zalogowaÄ‡ informacjÄ™ przy uÅ¼yciu Balloga. Czas wiÄ™c przejÅ›Ä‡ do kolejnego kroku i dowiedzieÄ‡ siÄ™ w jaki sposÃ³b moÅ¼emy przeprocesowaÄ‡ dane zewnÄ™trzne w ABAPie. WeÅºmy na przykÅ‚ad taki plik .csv, z ktÃ³rego chcielibyÅ›my przenieÅ›Ä‡ do tabeli:
employees Pobierz
Procedura jest ogÃ³lnie bÄ™dzie doÅ›Ä‡ prosta â€“ jednÄ… tabelkÄ™ juÅ¼ przecieÅ¼ mamy. Nasz program bÄ™dzie potrafiÅ‚:
wczytaÄ‡ dane od uÅ¼ytkownika, wprowadziÄ‡ nowe wpisy od uÅ¼ytkownika do bazy , wprowadziÄ‡ wpisy z serwera aplikacji do bazy.">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:56746/posts/dzialania-na-plikach/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css" integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:56746/profile.png">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:56746/profile.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:56746/profile.png">
<link rel="apple-touch-icon" href="http://localhost:56746/profile.png">
<link rel="mask-icon" href="http://localhost:56746/profile.png">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:56746/posts/dzialania-na-plikach/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
  
    
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-3R9CLWGY39"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-3R9CLWGY39');
        }
      </script>
    
  

<meta property="og:title" content="DziaÅ‚ania na plikach" />
<meta property="og:description" content="Potrafimy juÅ¼ tworzyÄ‡ podstawowe struktury danych, wiemy teÅ¼ jak zalogowaÄ‡ informacjÄ™ przy uÅ¼yciu Balloga. Czas wiÄ™c przejÅ›Ä‡ do kolejnego kroku i dowiedzieÄ‡ siÄ™ w jaki sposÃ³b moÅ¼emy przeprocesowaÄ‡ dane zewnÄ™trzne w ABAPie. WeÅºmy na przykÅ‚ad taki plik .csv, z ktÃ³rego chcielibyÅ›my przenieÅ›Ä‡ do tabeli:
employees Pobierz
Procedura jest ogÃ³lnie bÄ™dzie doÅ›Ä‡ prosta â€“ jednÄ… tabelkÄ™ juÅ¼ przecieÅ¼ mamy. Nasz program bÄ™dzie potrafiÅ‚:
wczytaÄ‡ dane od uÅ¼ytkownika, wprowadziÄ‡ nowe wpisy od uÅ¼ytkownika do bazy , wprowadziÄ‡ wpisy z serwera aplikacji do bazy." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:56746/posts/dzialania-na-plikach/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-05-06T17:53:34+01:00" />
<meta property="article:modified_time" content="2019-05-06T17:53:34+01:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="DziaÅ‚ania na plikach"/>
<meta name="twitter:description" content="Potrafimy juÅ¼ tworzyÄ‡ podstawowe struktury danych, wiemy teÅ¼ jak zalogowaÄ‡ informacjÄ™ przy uÅ¼yciu Balloga. Czas wiÄ™c przejÅ›Ä‡ do kolejnego kroku i dowiedzieÄ‡ siÄ™ w jaki sposÃ³b moÅ¼emy przeprocesowaÄ‡ dane zewnÄ™trzne w ABAPie. WeÅºmy na przykÅ‚ad taki plik .csv, z ktÃ³rego chcielibyÅ›my przenieÅ›Ä‡ do tabeli:
employees Pobierz
Procedura jest ogÃ³lnie bÄ™dzie doÅ›Ä‡ prosta â€“ jednÄ… tabelkÄ™ juÅ¼ przecieÅ¼ mamy. Nasz program bÄ™dzie potrafiÅ‚:
wczytaÄ‡ dane od uÅ¼ytkownika, wprowadziÄ‡ nowe wpisy od uÅ¼ytkownika do bazy , wprowadziÄ‡ wpisy z serwera aplikacji do bazy."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:56746/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "DziaÅ‚ania na plikach",
      "item": "http://localhost:56746/posts/dzialania-na-plikach/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "DziaÅ‚ania na plikach",
  "name": "DziaÅ‚ania na plikach",
  "description": "Potrafimy juÅ¼ tworzyÄ‡ podstawowe struktury danych, wiemy teÅ¼ jak zalogowaÄ‡ informacjÄ™ przy uÅ¼yciu Balloga. Czas wiÄ™c przejÅ›Ä‡ do kolejnego kroku i dowiedzieÄ‡ siÄ™ w jaki sposÃ³b moÅ¼emy przeprocesowaÄ‡ dane zewnÄ™trzne w ABAPie. WeÅºmy na przykÅ‚ad taki plik .csv, z ktÃ³rego chcielibyÅ›my przenieÅ›Ä‡ do tabeli:\nemployees Pobierz\nProcedura jest ogÃ³lnie bÄ™dzie doÅ›Ä‡ prosta â€“ jednÄ… tabelkÄ™ juÅ¼ przecieÅ¼ mamy. Nasz program bÄ™dzie potrafiÅ‚:\nwczytaÄ‡ dane od uÅ¼ytkownika, wprowadziÄ‡ nowe wpisy od uÅ¼ytkownika do bazy , wprowadziÄ‡ wpisy z serwera aplikacji do bazy.",
  "keywords": [
    "ABAP", "ABAP od podstaw"
  ],
  "articleBody": "Potrafimy juÅ¼ tworzyÄ‡ podstawowe struktury danych, wiemy teÅ¼ jak zalogowaÄ‡ informacjÄ™ przy uÅ¼yciu Balloga. Czas wiÄ™c przejÅ›Ä‡ do kolejnego kroku i dowiedzieÄ‡ siÄ™ w jaki sposÃ³b moÅ¼emy przeprocesowaÄ‡ dane zewnÄ™trzne w ABAPie. WeÅºmy na przykÅ‚ad taki plik .csv, z ktÃ³rego chcielibyÅ›my przenieÅ›Ä‡ do tabeli:\nemployees Pobierz\nProcedura jest ogÃ³lnie bÄ™dzie doÅ›Ä‡ prosta â€“ jednÄ… tabelkÄ™ juÅ¼ przecieÅ¼ mamy. Nasz program bÄ™dzie potrafiÅ‚:\nwczytaÄ‡ dane od uÅ¼ytkownika, wprowadziÄ‡ nowe wpisy od uÅ¼ytkownika do bazy , wprowadziÄ‡ wpisy z serwera aplikacji do bazy. Fajnie byÅ‚oby aby program byÅ‚ tak dynamicznie napisany, Å¼e nie bÄ™dziemy musieli go zmieniaÄ‡ nawet jeÅ¼eli bÄ™dziemy chcieÄ‡ â€wpisaÄ‡â€ dane do tabeli okreÅ›lonej w pierwszej kolumnie naszego pliku. JeÅ¼eli otworzymy zbiÃ³r danych, zobaczymy Å¼e prezentujÄ… siÄ™ one nastÄ™pujÄ…co:\nUwaga, w tym artykule przedstawiam dwa waÅ¼ne rozdziaÅ‚y: operacje na plikach i programowanie obiektowe. JeÅ›li niektÃ³re rozwiÄ…zania sÄ… dla Ciebie niejasne, bÄ…dÅº teÅ¼ chcesz dowiedzieÄ‡ siÄ™ wiÄ™cej to zapraszam CiÄ™ do zapoznania siÄ™ z ofertÄ…: https://saponit.pl/kurs-abap/ Tworzymy dodatkowÄ… tabelÄ™ PierwszÄ… kolumnÄ… w pliku csv oznaczona jest nazwa tabeli do ktÃ³rej chcemy wpisaÄ‡ dane. Dwie kolejne zawierajÄ… dane ktÃ³re chcemy do podanych tabel wpisaÄ‡. Potrzebujemy zatem poza tabelkÄ… ZEMPLOYEES jeszcze tabelÄ™ ZSALARIES. MoÅ¼emy jÄ… szybko utworzyÄ‡ w eclipse:\n@EndUserText.label : 'Employees salaries' @AbapCatalog.enhancementCategory : #NOT_EXTENSIBLE @AbapCatalog.tableCategory : #TRANSPARENT @AbapCatalog.deliveryClass : #A @AbapCatalog.dataMaintenance : #LIMITED define table zsalaries { key id : char3 not null; amount : integer64; } Tabele mamy gotowe, fajnie byÅ‚oby gdybyÅ›my mogli nie tylko uÅ¼ywaÄ‡ plikÃ³w pobranych od uÅ¼ytkownika, ale rÃ³wnieÅ¼ tych ktÃ³re sÄ… dostÄ™pne na app serwerze. O tym ostatnim jeszcze nie pisaÅ‚em w Å¼adnych z poprzednich poradnikÃ³w. NowoÅ›ciÄ… jest tu transakcja al11, ktÃ³ra sÅ‚uÅ¼y w NetVeawer do przechowywania plikÃ³w. MoÅ¼na powiedzieÄ‡, Å¼e jest ona odpowiednikiem windowsowego explorera, widaÄ‡ w niej foldery odpowiadajÄ…ce tym faktycznie umieszczonym na dysku twardym wirtualnej maszyny:\nDostÄ™p do plikÃ³w z poziomu ABAPa odpowiada dostÄ™powi z poziomu systemu operacyjnego. Jest to o tyle waÅ¼ne, Å¼e jeÅ¼eli uÅ¼ywamy Windowsa to wielkoÅ›Ä‡ znakÃ³w w Å›cieÅ¼ce do pliku nie ma znaczenia, natomiast w przypadku Linuxa jest odwrotnie. Nasz serwer aplikacji zainstalowany jest na maszynie z Linuxem, natomiast serwer prezentacji (czyli SAP GUI) moÅ¼emy mieÄ‡ zainstalowany na dowolnym systemie operacyjnym, np. Windows. Nasz development bÄ™dzie skÅ‚adaÄ‡ siÄ™ z dwÃ³ch klas i raportu sÅ‚uÅ¼Ä…cego do uruchomienia. Wykorzystamy tutaj dziedziczenie, czyli jednÄ… z zalet programowania obiektowego. JeÅ¼eli chcielibyÅ›my przedstawiÄ‡ klasy graficznie wyglÄ…daÅ‚oby to nastÄ™pujÄ…co:\nKlasa po ktÃ³rej bÄ™dziemy dziedziczyÄ‡ Zacznijmy od eclipse i stwÃ³rzmy pierwszÄ… klasÄ™ ZCL_FILE. Po pierwsze musimy zadeklarowaÄ‡ potrzebne typy danych: CLASS zcl_file DEFINITION PUBLIC CREATE PUBLIC . PUBLIC SECTION. TYPES t_string_tab TYPE string. TYPES tt_string_tab TYPE STANDARD TABLE OF t_string_tab. METHODS insert_to_table IMPORTING iv_table_name TYPE string it_table TYPE STANDARD TABLE. PROTECTED SECTION. METHODS process_table IMPORTING is_line_to_insert TYPE t_string_tab EXPORTING et_processed_data TYPE tt_string_tab ev_table_name TYPE string. PRIVATE SECTION. ENDCLASS. OkreÅ›lamy najpierw wÅ‚asne typy: strukturÄ™ zwierajÄ…cÄ… tylko stringi i tabelÄ™ do niej. W sekcji publicznej tworzymy rÃ³wnieÅ¼ dwie metody. Pierwsza z nich ma za zadanie wpisaÄ‡ nasze dane do tabeli, natomiast druga jest odpowiedzialna za odczytanie przekazanej lini z tabeli i okreÅ›lenia do jakiej tabeli wpis powinien trafiÄ‡.\nImplementacja: CLASS zcl_file IMPLEMENTATION. METHOD insert_to_table. \"deklarujemy tabele stringÃ³w DATA:lt_tab TYPE tt_string_tab. \"oraz dwie referencje, do danych i do opisu struktury DATA: lr_str TYPE REF TO data, lr_strd TYPE REF TO cl_abap_structdescr. \"tworzymy sobie referencje CREATE DATA lr_str TYPE (iv_table_name). \"i przypisujemy jÄ… do field-sybolu ASSIGN lr_str-\u003e* TO FIELD-SYMBOL(). \"pobieramy refernecjÄ™ do opisu naszej struktury na podstawie field-symbolu \"(moÅ¼na byÅ‚o rÃ³wnieÅ¼ pobraÄ‡ jÄ… po nazwie) lr_strd ?= cl_abap_tabledescr=\u003edescribe_by_data_ref( lr_str ). \"wykonujemy petle po wszytskich komponentach naszej struktury \"(w przypadku zemployees bÄ™dzie tu:ID,NAME,LAST_NAME) LOOP AT lr_strd-\u003ecomponents ASSIGNING FIELD-SYMBOL(). \"kaÅ¼dy z komponentÃ³w przypisujemy do zmiennej ASSIGN COMPONENT -name OF STRUCTURE TO FIELD-SYMBOL(). \"z odczytanej lini z danymi bierzemy odpowiedniÄ… wartoÅ›Ä‡, o takiej samej kolejnoÅ›ci \"jak ta odczytana z kompnentu \"(w przypadku naszego pliku pierwsze bÄ™dzie tu: JNO \") ASSIGN it_table[ sy-tabix ] TO FIELD-SYMBOL() . \"do struktury przypisujemy dane z odczytanej lini, teraz nasze dane \"powinny byÄ‡ w poprawnym typie w = . ENDLOOP. \"wpisujemy dane do tabeli w bazie danych MODIFY (iv_table_name) FROM . \"jeÅ›li wystÄ…pi bÅ‚Ä…d, zwrÃ³Ä‡ wiadomoÅ›Ä‡ IF sy-subrc = 2. MESSAGE 'Error occured while modify' TYPE 'E'. ENDIF. ENDMETHOD. METHOD process_table. \"podziel linie po przecinku tak Å¼eby powstaÅ‚a z nich tabela SPLIT is_line_to_insert AT ',' INTO TABLE DATA(lt_split). \"wybierz pierwszÄ… wartoÅ›Ä‡, ktÃ³ra opisuje tabelÄ™ do ktÃ³rej \"trafiÄ… dane DATA(lv_tab_name) = lt_split[ 1 ]. \"usuwany tÄ… wartoÅ›Ä‡ z tabeli DELETE lt_split INDEX 1. et_processed_data = lt_split. ev_table_name = lv_tab_name. ENDMETHOD. ENDCLASS. JeÅ¼eli mimo opisu nie do koÅ„ca rozumiesz co dzieje siÄ™ w kodzie to siÄ™ nie przejmuj. Jak program bÄ™dzie juÅ¼ gotowy po prostu przedebugguj siÄ™ przez niego.\nObsÅ‚uga plikÃ³w z serwera aplikacji Zacznijmy od umieszczenia pliku na serwerze aplikacji. Jak wspominaÅ‚em wczeÅ›niej w al11 moÅ¼emy zobaczyÄ‡ pliki w tym samym miejscu w ktÃ³rym widaÄ‡ je z poziomu systemu operacyjnego. MoÅ¼emy wiÄ™c przenieÅ›Ä‡ je tam za pomocÄ… ssh i nadajÄ…c im uprawnienia dla npladm, lub uÅ¼yÄ‡ moduÅ‚u funkcyjnego ARCHIVFILE_CLIENT_TO_SERVER. WaÅ¼ne jest aby koniecznie przed wprowadzaniem danych zaznaczyÄ‡ flagÄ™ Uppercase/Lowercase.\nNastÄ™pnie w path podajemy Å›cieÅ¼kÄ™ do pliku na naszym systemie operacyjnym (w Windows bÄ™dzie ona zaczynaÄ‡ siÄ™ prawdopodobnie od C:), natomiast w targetpath Å›cieÅ¼kÄ™ w ktÃ³rej chcemy zapisaÄ‡ plik na serwerze aplikacji. NastÄ™pnie uruchamiamy modÃ³Å‚ i sprawdzamy czy plik faktycznie znajduje siÄ™ w katalogu /usr/sap/NPL/D00/work/.\nJeÅ¼eli dwa razy klikniemy w plik powinniÅ›my zobaczyÄ‡ jego zawartoÅ›Ä‡:\nPrzejdÅºmy teraz do definicji klasy ZCL_FILE_SERVER CLASS zcl_file_server DEFINITION INHERITING FROM zcl_file PUBLIC FINAL CREATE PUBLIC. PUBLIC SECTION. METHODS constructor IMPORTING iv_path TYPE string. METHODS process_server_data. METHODS: get_ov_path RETURNING VALUE(r_result) TYPE string, set_ov_path IMPORTING iv_ov_path TYPE string. PROTECTED SECTION. PRIVATE SECTION. DATA: ov_path TYPE string. ENDCLASS. Klasa dziedziczy po klasie ZCL_FILE i dlatego potrzebujemy INHERITING FROM. Po naszej klasie nie bÄ™dzie moÅ¼na dziedziczyÄ‡, dlatego posiada dopisek â€finalâ€. WewnÄ…trz klasy tworzymy prywatny parametr path, ktÃ³ry odczytaÄ‡ moÅ¼emy za pomocÄ… gettera a zapisaÄ‡ za pomocÄ… settera. Jest to zgodne z zasadami programowania obiektowego, i umoÅ¼liwia nam stworzenie np. dodatkowej walidacji w setterze gdzie moÅ¼emy sprawdziÄ‡ czy nasza Å›cieÅ¼ka zawiera charakterystyczne znaki jak np. â€/â€. Do parametru prywatnego nie mamy dostÄ™pu zarÃ³wno z poziomu obiektu klasy, jak i w przypadku dziedziczenia. Implementacja bÄ™dzie wyglÄ…daÄ‡ nastÄ™pujÄ…co:\nCLASS zcl_file_server IMPLEMENTATION. METHOD constructor. \"konstruktor jest wywoÅ‚ywany podczas tworzenia obiektu i ustawia argument klasy \"ov_path przy uÅ¼yciu settera \"zgodnie z wymaganimi musimy zawsze wywoÅ‚aÄ‡ konstruktor nadrzÄ™dny, ktÃ³ry mimo \"tego Å¼e nie jest przez nas zadeklarowany to niejawnie istnieje super-\u003econstructor( ). set_ov_path( iv_ov_path = iv_path ). ENDMETHOD. METHOD process_server_data. \"tworzymy strukturÄ™ typu string DATA ls_data TYPE t_string_tab. \"pobieramy Å›cieÅ¼kÄ™ do pliku z atrybutu ov_path DATA(lv_path) = get_ov_path( ). \"otwieramy nasz plik z danymi do odczytu w trybie tekstowym OPEN DATASET lv_path FOR INPUT IN TEXT MODE ENCODING DEFAULT. \"jeÅ›li pojawi siÄ™ bÅ‚Ä…d, pokaÅ¼ wiadomoÅ›Ä‡ o bÅ‚Ä™dzie IF sy-subrc \u003c\u003e 0. MESSAGE 'Can not open file for read' TYPE 'E'. EXIT. ENDIF. DO. \"czytaj plik linia po linii READ DATASET lv_path INTO ls_data. \"jeÅ›li wystÄ…piÅ‚ bÅ‚Ä…d to plik prawdopodobnie zostaÅ‚ juÅ¼ odczytany do koÅ„ca IF sy-subrc \u003c\u003e 0. EXIT. ENDIF. \"wywoÅ‚aj metodÄ™ process_table z ZCL_FILE (dziedziczymy jÄ…) \"do tabeli wyeksportuj linie z naszego pliku i pobierz \"danÄ™ oraz tabele do ktorej naleÅ¼y je wpisaÄ‡. process_table( EXPORTING is_line_to_insert = ls_data IMPORTING et_processed_data = DATA(lt_ctab) ev_table_name = DATA(lv_tab) ). \"wywoÅ‚aj metodÄ™ insert_to_table z ZCL_FILE (dziedziczymy jÄ…) \"do tabeli wyeksportuj dane, oraz nazwÄ™ tabeli \"do ktÃ³rej naleÅ¼y je wpisaÄ‡ insert_to_table( EXPORTING iv_table_name = lv_tab it_table = lt_ctab ). ENDDO. \"jeÅ›li wszystko poszÅ‚o ok, wyÅ›wietl komunikat o bÅ‚Ä™dzie MESSAGE 'Processing succesfull' TYPE 'S'. ENDMETHOD. METHOD get_ov_path. r_result = me-\u003eov_path. ENDMETHOD. METHOD set_ov_path. me-\u003eov_path = iv_ov_path. ENDMETHOD. ENDCLASS. Raport uruchamiajÄ…cy przetwaÅ¼anie Finalnie moÅ¼emy przejÅ›Ä‡ do stworzenia raportu ktÃ³ry bÄ™dzie odpowiedzialny za uruchamianie naszej implementacji:\nREPORT zload_data. PARAMETERS: pa_path TYPE dxfields-longpath LOWER CASE, pa_sapp RADIOBUTTON GROUP rb1 USER-COMMAND gr1 DEFAULT 'X', pa_sagu RADIOBUTTON GROUP rb1. \"ObsÅ‚uga evetu ktÃ³ry umoÅ¼liwia nam wyÅ›wietlenie menu z pomocÄ… we wprowadzeniu \"Å›ciezki do parametru path AT SELECTION-SCREEN ON VALUE-REQUEST FOR pa_path. DATA(lv_loc) = SWITCH dxfields-location( pa_sapp WHEN abap_true THEN 'A' WHEN abap_false THEN 'P' ). CALL FUNCTION 'F4_DXFILENAME_TOPRECURSION' EXPORTING i_location_flag = lv_loc i_path = pa_path IMPORTING o_path = pa_path EXCEPTIONS rfc_error = 1 error_with_gui = 2 OTHERS = 3. IF sy-subrc \u0026lt;\u003e 0. MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4. ENDIF. AT SELECTION-SCREEN. IF sy-ucomm \u0026lt;\u003e 'GR1' AND pa_path IS INITIAL. MESSAGE 'File path is required' TYPE 'E'. ENDIF. START-OF-SELECTION. DATA: lt_tab TYPE zcl_file=\u003ett_string_tab. IF pa_sagu = abap_true. \"tworzymy nowy obiekt DATA(lobj_app_server) = NEW zcl_file_gui( ). \"chcemy znaÄ‡ powÃ³d dla ktÃ³rego nie moÅ¼emy zauploadowaÄ‡ pliku \"z GUI, dlatego EXCEPTIONS sÄ… odkomentowane w caÅ‚oÅ›ci cl_gui_frontend_services=\u003egui_upload( EXPORTING filename = CONV #( pa_path ) CHANGING data_tab = lt_tab EXCEPTIONS file_open_error = 1 file_read_error = 2 no_batch = 3 gui_refuse_filetransfer = 4 invalid_type = 5 no_authority = 6 unknown_error = 7 bad_data_format = 8 header_not_allowed = 9 separator_not_allowed = 10 header_too_long = 11 unknown_dp_error = 12 access_denied = 13 dp_out_of_memory = 14 disk_full = 15 dp_timeout = 16 not_supported_by_gui = 17 error_no_gui = 18 OTHERS = 19 ). IF sy-subrc \u0026lt;\u003e 0. MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4. ENDIF. \"uruchamiamy metodÄ™ process_gui_data i przekazuemy dane wczytane z GUI lobj_app_server-\u003eprocess_gui_data( lt_table = lt_tab ). ELSE. \"tworzymy obiekt i przekazujemy wymagne dane do konstruktora DATA(lobj_file_server) = NEW zcl_file_server( iv_path = CONV #( pa_path ) ). \"uruchamiamy metodÄ™ do przetwarzania danych z serwera apikacji lobj_file_server-\u003eprocess_server_data( ). ENDIF. Text elementy do raportu powinny wyglÄ…daÄ‡ nastÄ™pujÄ…co:\nFinalnie powinniÅ›my mieÄ‡ trzy nowe klasy i raport oraz dwie tabele i plik widoczny w al11:\nPrzed uruchomieniem programu tabele powinny byÄ‡ puste, natomiast po jego uruchomieniu powinny wypeÅ‚niÄ‡ siÄ™ danymi:\nW tej lekcji to juÅ¼ wszystko. JeÅ›li plik przeprocesowaÅ‚ siÄ™ poprawnie, wpisy w obu tabelach powinny pojawiÄ‡ siÄ™ natychmiast po uruchomieniu. Pliki utworzone podczas tej lekcji moÅ¼ecie znaleÅºÄ‡ teÅ¼ na githubie:\nhttps://github.com/pawelwiejkut/abap_operacje_na_plikach.git\n",
  "wordCount" : "1609",
  "inLanguage": "en",
  "datePublished": "2019-05-06T17:53:34+01:00",
  "dateModified": "2019-05-06T17:53:34+01:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:56746/posts/dzialania-na-plikach/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Pawel Wiejkut",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:56746/profile.png"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:56746/" accesskey="h" title="Pawel Wiejkut (Alt + H)">Pawel Wiejkut</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:56746/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span><i class='fa fa-heart'></i>Search</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:56746/about-me/" title="About me">
                    <span>About me</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:56746/bw/" title="BW">
                    <span>BW</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:56746/sac-tutorial/" title="SAC">
                    <span>SAC</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:56746/abap-od-podstaw/" title="ABAP od postaw ğŸ‡µğŸ‡± ">
                    <span>ABAP od postaw ğŸ‡µğŸ‡± </span>
                </a>
            </li>
            <li>
                <a href="http://localhost:56746/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:56746/posts/" title="Posts">
                    <span>Posts</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      DziaÅ‚ania na plikach
    </h1>
    <div class="post-meta"><span title='2019-05-06 17:53:34 +0100 +0100'>May 6, 2019</span>&nbsp;Â·&nbsp;8 min&nbsp;|&nbsp;<a href="https://github.com/pawelwiejkut/pawelwiejkut.dev/tree/main/content/posts/dzialania-na-plikach.md" rel="noopener noreferrer" target="_blank">Suggest Changes</a>

</div>
  </header> 
  <div class="post-content"><p>Potrafimy juÅ¼ tworzyÄ‡ podstawowe struktury danych, wiemy teÅ¼ jak zalogowaÄ‡ informacjÄ™ przy uÅ¼yciu Balloga. Czas wiÄ™c przejÅ›Ä‡ do kolejnego kroku i dowiedzieÄ‡ siÄ™ w jaki sposÃ³b moÅ¼emy przeprocesowaÄ‡ dane zewnÄ™trzne w ABAPie. WeÅºmy na przykÅ‚ad taki plik .csv, z ktÃ³rego chcielibyÅ›my przenieÅ›Ä‡ do tabeli:</p>
<p>employees <a href="/dzialania_na_plikach/employees.csv">Pobierz</a></br></p>
<p>Procedura jest ogÃ³lnie bÄ™dzie doÅ›Ä‡ prosta â€“ jednÄ… tabelkÄ™ juÅ¼ przecieÅ¼ mamy. Nasz program bÄ™dzie potrafiÅ‚:</p>
<ul>
<li>wczytaÄ‡ dane od uÅ¼ytkownika,</li>
<li>wprowadziÄ‡ nowe wpisy od uÅ¼ytkownika do bazy ,</li>
<li>wprowadziÄ‡ wpisy z serwera aplikacji do bazy.</br></li>
</ul>
<p>Fajnie byÅ‚oby aby program byÅ‚ tak dynamicznie napisany, Å¼e nie bÄ™dziemy musieli go zmieniaÄ‡ nawet jeÅ¼eli bÄ™dziemy chcieÄ‡ â€wpisaÄ‡â€ dane do tabeli okreÅ›lonej w pierwszej kolumnie naszego pliku. JeÅ¼eli otworzymy zbiÃ³r danych, zobaczymy Å¼e prezentujÄ… siÄ™ one nastÄ™pujÄ…co:</p>
<figure class="align-center ">
    <img loading="lazy" src="/dzialania_na_plikach/1.png#center" width="60%"/> 
</figure>

<p>Uwaga, w tym artykule przedstawiam dwa waÅ¼ne rozdziaÅ‚y: operacje na plikach i programowanie obiektowe. JeÅ›li niektÃ³re rozwiÄ…zania sÄ… dla Ciebie niejasne, bÄ…dÅº teÅ¼ chcesz dowiedzieÄ‡ siÄ™ wiÄ™cej to <mark>
zapraszam CiÄ™ do zapoznania siÄ™ z ofertÄ…: <a href="https://saponit.pl/kurs-abap/">https://saponit.pl/kurs-abap/</a> </mark></p>
<h1 id="tworzymy-dodatkowÄ…-tabelÄ™">Tworzymy dodatkowÄ… tabelÄ™<a hidden class="anchor" aria-hidden="true" href="#tworzymy-dodatkowÄ…-tabelÄ™">#</a></h1>
<p>PierwszÄ… kolumnÄ… w pliku csv oznaczona jest nazwa tabeli do ktÃ³rej chcemy wpisaÄ‡ dane. Dwie kolejne zawierajÄ… dane ktÃ³re chcemy do podanych tabel wpisaÄ‡. Potrzebujemy zatem poza tabelkÄ… ZEMPLOYEES jeszcze tabelÄ™ ZSALARIES. MoÅ¼emy jÄ… szybko utworzyÄ‡ w eclipse:</p>
<p><figure class="align-center ">
    <img loading="lazy" src="/dzialania_na_plikach/2.png#center" width="60%"/> 
</figure>

<figure class="align-center ">
    <img loading="lazy" src="/dzialania_na_plikach/3.png#center" width="60%"/> 
</figure>
</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-abap" data-lang="abap"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">@</span>EndUserText.label : <span style="color:#e6db74">&#39;Employees salaries&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">@</span>AbapCatalog.enhancementCategory : <span style="color:#960050;background-color:#1e0010">#</span>NOT_EXTENSIBLE
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">@</span>AbapCatalog.tableCategory : <span style="color:#960050;background-color:#1e0010">#</span>TRANSPARENT
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">@</span>AbapCatalog.deliveryClass : <span style="color:#960050;background-color:#1e0010">#</span>A
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">@</span>AbapCatalog.dataMaintenance : <span style="color:#960050;background-color:#1e0010">#</span>LIMITED
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">define</span> <span style="color:#66d9ef">table</span> zsalaries <span style="color:#960050;background-color:#1e0010">{</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">key</span> <span style="color:#66d9ef">id</span> : char3 <span style="color:#f92672">not</span> null;
</span></span><span style="display:flex;"><span>  amount : integer64; <span style="color:#960050;background-color:#1e0010">}</span></span></span></code></pre></div>
<p>Tabele mamy gotowe, fajnie byÅ‚oby gdybyÅ›my mogli nie tylko uÅ¼ywaÄ‡ plikÃ³w pobranych od uÅ¼ytkownika, ale rÃ³wnieÅ¼ tych ktÃ³re sÄ… dostÄ™pne na app serwerze. O tym ostatnim jeszcze nie pisaÅ‚em w Å¼adnych z poprzednich poradnikÃ³w. NowoÅ›ciÄ… jest tu transakcja al11, ktÃ³ra sÅ‚uÅ¼y w NetVeawer do przechowywania plikÃ³w. MoÅ¼na powiedzieÄ‡, Å¼e jest ona odpowiednikiem windowsowego explorera, widaÄ‡ w niej foldery odpowiadajÄ…ce tym faktycznie umieszczonym na dysku twardym wirtualnej maszyny:</p>
<figure class="align-center ">
    <img loading="lazy" src="/dzialania_na_plikach/4.png#center" width="80%"/> 
</figure>

<p>DostÄ™p do plikÃ³w z poziomu ABAPa odpowiada dostÄ™powi z poziomu systemu operacyjnego. Jest to o tyle waÅ¼ne, Å¼e jeÅ¼eli uÅ¼ywamy Windowsa to wielkoÅ›Ä‡ znakÃ³w w Å›cieÅ¼ce do pliku nie ma znaczenia, <mark>natomiast w przypadku Linuxa jest odwrotnie. Nasz serwer aplikacji zainstalowany jest na maszynie z Linuxem</mark>, natomiast serwer prezentacji (czyli SAP GUI) moÅ¼emy mieÄ‡ zainstalowany na dowolnym systemie operacyjnym, np. Windows.
Nasz development bÄ™dzie skÅ‚adaÄ‡ siÄ™ z dwÃ³ch klas i raportu sÅ‚uÅ¼Ä…cego do uruchomienia. Wykorzystamy tutaj dziedziczenie, czyli jednÄ… z zalet programowania obiektowego. JeÅ¼eli chcielibyÅ›my przedstawiÄ‡ klasy graficznie wyglÄ…daÅ‚oby to nastÄ™pujÄ…co:</p>
<figure class="align-center ">
    <img loading="lazy" src="/dzialania_na_plikach/5.png#center" width="80%"/> 
</figure>

<h1 id="klasa-po-ktÃ³rej-bÄ™dziemy-dziedziczyÄ‡">Klasa po ktÃ³rej bÄ™dziemy dziedziczyÄ‡<a hidden class="anchor" aria-hidden="true" href="#klasa-po-ktÃ³rej-bÄ™dziemy-dziedziczyÄ‡">#</a></h1>
<ol>
<li>Zacznijmy od eclipse i stwÃ³rzmy pierwszÄ… klasÄ™ ZCL_FILE. Po pierwsze musimy zadeklarowaÄ‡ potrzebne typy danych:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-abap" data-lang="abap"><span style="display:flex;"><span><span style="color:#66d9ef">CLASS</span> zcl_file <span style="color:#66d9ef">DEFINITION</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">PUBLIC</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">CREATE PUBLIC</span> .
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">PUBLIC SECTION</span>.
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">TYPES</span> t_string_tab  <span style="color:#66d9ef">TYPE </span>string.
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">TYPES</span> tt_string_tab <span style="color:#66d9ef">TYPE STANDARD TABLE OF</span> t_string_tab.
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">METHODS</span> insert_to_table
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">IMPORTING</span> iv_table_name <span style="color:#66d9ef">TYPE </span>string
</span></span><span style="display:flex;"><span>                it_table      <span style="color:#66d9ef">TYPE </span>STANDARD <span style="color:#66d9ef">TABLE</span>.
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">PROTECTED SECTION</span>.
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">METHODS</span> process_table
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">IMPORTING</span> is_line_to_insert <span style="color:#66d9ef">TYPE </span>t_string_tab
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">EXPORTING</span> et_processed_data <span style="color:#66d9ef">TYPE </span>tt_string_tab
</span></span><span style="display:flex;"><span>                ev_table_name     <span style="color:#66d9ef">TYPE </span>string.
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">PRIVATE SECTION</span>.
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ENDCLASS</span>.</span></span></code></pre></div>
<p>OkreÅ›lamy najpierw wÅ‚asne typy: strukturÄ™ zwierajÄ…cÄ… tylko stringi i tabelÄ™ do niej. W sekcji publicznej tworzymy rÃ³wnieÅ¼ dwie metody. Pierwsza z nich ma za zadanie wpisaÄ‡ nasze dane do tabeli, natomiast druga jest odpowiedzialna za odczytanie przekazanej lini z tabeli i okreÅ›lenia do jakiej tabeli wpis powinien trafiÄ‡.</p>
<ol start="2">
<li>Implementacja:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-abap" data-lang="abap"><span style="display:flex;"><span><span style="color:#66d9ef">CLASS</span> zcl_file <span style="color:#66d9ef">IMPLEMENTATION</span>.
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">METHOD</span> <span style="color:#a6e22e">insert_to_table</span>.
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">&#34;deklarujemy tabele stringÃ³w
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">DATA</span>:lt_tab  <span style="color:#66d9ef">TYPE </span>tt_string_tab.
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">&#34;oraz dwie referencje, do danych i do opisu struktury
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">DATA</span>:
</span></span><span style="display:flex;"><span>      lr_str  <span style="color:#66d9ef">TYPE REF TO</span> <span style="color:#66d9ef">data</span>,
</span></span><span style="display:flex;"><span>      lr_strd <span style="color:#66d9ef">TYPE REF TO</span> cl_abap_structdescr.
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">&#34;tworzymy sobie referencje
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">CREATE DATA</span> lr_str TYPE (iv_table_name).
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">&#34;i przypisujemy jÄ… do field-sybolu
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">ASSIGN</span> lr_str-&gt;* <span style="color:#66d9ef">TO</span> <span style="color:#66d9ef">FIELD</span><span style="color:#f92672">-</span>SYMBOL(&lt;ls_str&gt;).
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">&#34;pobieramy refernecjÄ™ do opisu naszej struktury na podstawie field-symbolu
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">&#34;(moÅ¼na byÅ‚o rÃ³wnieÅ¼ pobraÄ‡ jÄ… po nazwie)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    lr_strd <span style="color:#f92672">?=</span> cl_abap_tabledescr<span style="color:#f92672">=&gt;</span><span style="color:#a6e22e">describe_by_data_ref</span>( lr_str ).
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">&#34;wykonujemy petle po wszytskich komponentach naszej struktury
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">&#34;(w przypadku zemployees bÄ™dzie tu:ID,NAME,LAST_NAME)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">LOOP AT </span>lr_strd<span style="color:#f92672">-&gt;</span>components <span style="color:#66d9ef">ASSIGNING</span> <span style="color:#66d9ef">FIELD</span><span style="color:#f92672">-</span>SYMBOL(&lt;ls_comp&gt;).
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">&#34;kaÅ¼dy z komponentÃ³w przypisujemy do zmiennej
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">ASSIGN</span> <span style="color:#66d9ef">COMPONENT</span> &lt;ls_comp&gt;<span style="color:#f92672">-</span>name <span style="color:#66d9ef">OF STRUCTURE</span> &lt;ls_str&gt; <span style="color:#66d9ef">TO</span> <span style="color:#66d9ef">FIELD</span><span style="color:#f92672">-</span>SYMBOL(&lt;lv_comp&gt;).
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">&#34;z odczytanej lini z danymi bierzemy odpowiedniÄ… wartoÅ›Ä‡, o takiej samej kolejnoÅ›ci
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#75715e">&#34;jak ta odczytana z kompnentu
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#75715e">&#34;(w przypadku naszego pliku pierwsze bÄ™dzie tu: JNO &#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">ASSIGN</span> it_table[ sy<span style="color:#f92672">-</span>tabix ] <span style="color:#66d9ef">TO</span> <span style="color:#66d9ef">FIELD</span><span style="color:#f92672">-</span>SYMBOL(&lt;ls_ctab&gt;) .
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">&#34;do struktury przypisujemy dane z odczytanej lini, teraz nasze dane
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#75715e">&#34;powinny byÄ‡ w poprawnym typie w &lt;ls_str&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      &lt;lv_comp&gt; <span style="color:#f92672">=</span> &lt;ls_ctab&gt;.
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">ENDLOOP</span>.
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">&#34;wpisujemy dane do tabeli w bazie danych
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">MODIFY</span> (iv_table_name) <span style="color:#66d9ef">FROM</span> &lt;ls_str&gt;.
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">&#34;jeÅ›li wystÄ…pi bÅ‚Ä…d, zwrÃ³Ä‡ wiadomoÅ›Ä‡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">IF</span> sy<span style="color:#f92672">-</span>subrc <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>.
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">MESSAGE</span> <span style="color:#e6db74">&#39;Error occured while modify&#39;</span> TYPE <span style="color:#e6db74">&#39;E&#39;</span>.
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">ENDIF</span>.
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">ENDMETHOD</span>.
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">METHOD</span> <span style="color:#a6e22e">process_table</span>.
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">&#34;podziel linie po przecinku tak Å¼eby powstaÅ‚a z nich tabela
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">SPLIT</span> is_line_to_insert <span style="color:#66d9ef">AT</span> <span style="color:#e6db74">&#39;,&#39;</span> <span style="color:#66d9ef">INTO</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">DATA</span>(lt_split).
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">&#34;wybierz pierwszÄ… wartoÅ›Ä‡, ktÃ³ra opisuje tabelÄ™ do ktÃ³rej
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">&#34;trafiÄ… dane
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">DATA</span>(lv_tab_name) <span style="color:#f92672">=</span> lt_split[ <span style="color:#ae81ff">1</span> ].
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">&#34;usuwany tÄ… wartoÅ›Ä‡ z tabeli
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">DELETE</span> lt_split <span style="color:#66d9ef">INDEX</span> <span style="color:#ae81ff">1</span>.
</span></span><span style="display:flex;"><span>    et_processed_data <span style="color:#f92672">=</span> lt_split.
</span></span><span style="display:flex;"><span>    ev_table_name <span style="color:#f92672">=</span> lv_tab_name.
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">ENDMETHOD</span>.
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ENDCLASS</span>.</span></span></code></pre></div>
<p>JeÅ¼eli mimo opisu nie do koÅ„ca rozumiesz co dzieje siÄ™ w kodzie to siÄ™ nie przejmuj. Jak program bÄ™dzie juÅ¼ gotowy po prostu przedebugguj siÄ™ przez niego.</p>
<h1 id="obsÅ‚uga-plikÃ³w-z-serwera-aplikacji">ObsÅ‚uga plikÃ³w z serwera aplikacji<a hidden class="anchor" aria-hidden="true" href="#obsÅ‚uga-plikÃ³w-z-serwera-aplikacji">#</a></h1>
<p>Zacznijmy od umieszczenia pliku na serwerze aplikacji. Jak wspominaÅ‚em wczeÅ›niej w al11 moÅ¼emy zobaczyÄ‡ pliki w tym samym miejscu w ktÃ³rym widaÄ‡ je z poziomu systemu operacyjnego. MoÅ¼emy wiÄ™c przenieÅ›Ä‡ je tam za pomocÄ… ssh i nadajÄ…c im uprawnienia dla npladm, lub uÅ¼yÄ‡ moduÅ‚u funkcyjnego ARCHIVFILE_CLIENT_TO_SERVER. WaÅ¼ne jest aby koniecznie przed wprowadzaniem danych zaznaczyÄ‡ flagÄ™ Uppercase/Lowercase.</p>
<figure class="align-center ">
    <img loading="lazy" src="/dzialania_na_plikach/6.png#center" width="80%"/> 
</figure>

<p>NastÄ™pnie w path podajemy Å›cieÅ¼kÄ™ do pliku na naszym systemie operacyjnym (w Windows bÄ™dzie ona zaczynaÄ‡ siÄ™ prawdopodobnie od C:), natomiast w targetpath Å›cieÅ¼kÄ™ w ktÃ³rej chcemy zapisaÄ‡ plik na serwerze aplikacji. NastÄ™pnie uruchamiamy modÃ³Å‚ i sprawdzamy czy plik faktycznie znajduje siÄ™ w katalogu /usr/sap/NPL/D00/work/.</p>
<figure class="align-center ">
    <img loading="lazy" src="/dzialania_na_plikach/7.png#center" width="60%"/> 
</figure>

<p>JeÅ¼eli dwa razy klikniemy w plik powinniÅ›my zobaczyÄ‡ jego zawartoÅ›Ä‡:</p>
<figure class="align-center ">
    <img loading="lazy" src="/dzialania_na_plikach/8.png#center" width="40%"/> 
</figure>

<ol start="3">
<li>PrzejdÅºmy teraz do definicji klasy ZCL_FILE_SERVER</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-abap" data-lang="abap"><span style="display:flex;"><span><span style="color:#66d9ef">CLASS</span> zcl_file_server <span style="color:#66d9ef">DEFINITION</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">INHERITING FROM</span> zcl_file
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">PUBLIC</span>
</span></span><span style="display:flex;"><span>  FINAL
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">CREATE PUBLIC</span>.
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">PUBLIC SECTION</span>.
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">METHODS</span> constructor
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">IMPORTING</span> iv_path <span style="color:#66d9ef">TYPE </span>string.
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">METHODS</span> process_server_data.
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">METHODS</span>: get_ov_path <span style="color:#66d9ef">RETURNING</span> <span style="color:#66d9ef">VALUE</span>(r_result) <span style="color:#66d9ef">TYPE </span>string,
</span></span><span style="display:flex;"><span>      set_ov_path <span style="color:#66d9ef">IMPORTING</span> iv_ov_path <span style="color:#66d9ef">TYPE </span>string.
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">PROTECTED SECTION</span>.
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">PRIVATE SECTION</span>.
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">DATA</span>: ov_path <span style="color:#66d9ef">TYPE </span>string.
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ENDCLASS</span>.</span></span></code></pre></div>
<p>Klasa dziedziczy po klasie ZCL_FILE i dlatego potrzebujemy INHERITING FROM. Po naszej klasie nie bÄ™dzie moÅ¼na dziedziczyÄ‡, dlatego posiada dopisek â€finalâ€. WewnÄ…trz klasy tworzymy prywatny parametr path, ktÃ³ry odczytaÄ‡ moÅ¼emy za pomocÄ… gettera a zapisaÄ‡ za pomocÄ… settera. Jest to zgodne z zasadami programowania obiektowego, i umoÅ¼liwia nam stworzenie np. dodatkowej walidacji w setterze gdzie moÅ¼emy sprawdziÄ‡ czy nasza Å›cieÅ¼ka zawiera charakterystyczne znaki jak np. â€/â€. Do parametru prywatnego nie mamy dostÄ™pu zarÃ³wno z poziomu obiektu klasy, jak i w przypadku dziedziczenia. Implementacja bÄ™dzie wyglÄ…daÄ‡ nastÄ™pujÄ…co:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-abap" data-lang="abap"><span style="display:flex;"><span><span style="color:#66d9ef">CLASS</span> zcl_file_server <span style="color:#66d9ef">IMPLEMENTATION</span>.
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">METHOD</span> <span style="color:#a6e22e">constructor</span>.
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">&#34;konstruktor jest wywoÅ‚ywany podczas tworzenia obiektu i ustawia argument klasy
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">&#34;ov_path przy uÅ¼yciu settera
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">&#34;zgodnie z wymaganimi musimy zawsze wywoÅ‚aÄ‡ konstruktor nadrzÄ™dny, ktÃ³ry mimo
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">&#34;tego Å¼e nie jest przez nas zadeklarowany to niejawnie istnieje
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    super<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">constructor</span>( ).
</span></span><span style="display:flex;"><span>    set_ov_path( iv_ov_path <span style="color:#f92672">=</span> iv_path  ).
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">ENDMETHOD</span>.
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">METHOD</span> <span style="color:#a6e22e">process_server_data</span>.
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">&#34;tworzymy strukturÄ™ typu string
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">DATA</span> ls_data <span style="color:#66d9ef">TYPE </span>t_string_tab.
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">&#34;pobieramy Å›cieÅ¼kÄ™ do pliku z atrybutu ov_path
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">DATA</span>(lv_path) <span style="color:#f92672">=</span> get_ov_path( ).
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">&#34;otwieramy nasz plik z danymi do odczytu w trybie tekstowym
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">OPEN DATASET</span> lv_path <span style="color:#66d9ef">FOR</span> INPUT <span style="color:#66d9ef">IN</span> TEXT MODE ENCODING <span style="color:#66d9ef">DEFAULT</span>.
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">&#34;jeÅ›li pojawi siÄ™ bÅ‚Ä…d, pokaÅ¼ wiadomoÅ›Ä‡ o bÅ‚Ä™dzie
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">IF</span> sy<span style="color:#f92672">-</span>subrc <span style="color:#f92672">&lt;&gt;</span> <span style="color:#ae81ff">0</span>.
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">MESSAGE</span> <span style="color:#e6db74">&#39;Can not open file for read&#39;</span> TYPE <span style="color:#e6db74">&#39;E&#39;</span>.
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">EXIT</span>.
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">ENDIF</span>.
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">DO</span>.
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">&#34;czytaj plik linia po linii
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">READ</span> DATASET lv_path <span style="color:#66d9ef">INTO</span> ls_data.
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">&#34;jeÅ›li wystÄ…piÅ‚ bÅ‚Ä…d to plik prawdopodobnie zostaÅ‚ juÅ¼ odczytany do koÅ„ca
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">IF</span> sy<span style="color:#f92672">-</span>subrc <span style="color:#f92672">&lt;&gt;</span> <span style="color:#ae81ff">0</span>.
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">EXIT</span>.
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">ENDIF</span>.
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">&#34;wywoÅ‚aj metodÄ™ process_table z ZCL_FILE (dziedziczymy jÄ…)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#75715e">&#34;do tabeli wyeksportuj linie z naszego pliku i pobierz
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#75715e">&#34;danÄ™ oraz tabele do ktorej naleÅ¼y je wpisaÄ‡.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      process_table(
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">EXPORTING</span>
</span></span><span style="display:flex;"><span>          is_line_to_insert <span style="color:#f92672">=</span> ls_data
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">IMPORTING</span>
</span></span><span style="display:flex;"><span>          et_processed_data <span style="color:#f92672">=</span> <span style="color:#66d9ef">DATA</span>(lt_ctab)
</span></span><span style="display:flex;"><span>          ev_table_name     <span style="color:#f92672">=</span> <span style="color:#66d9ef">DATA</span>(lv_tab) ).
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">&#34;wywoÅ‚aj metodÄ™ insert_to_table z ZCL_FILE (dziedziczymy jÄ…)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#75715e">&#34;do tabeli wyeksportuj dane, oraz nazwÄ™ tabeli
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#75715e">&#34;do ktÃ³rej naleÅ¼y je wpisaÄ‡
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      insert_to_table(
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">EXPORTING</span>
</span></span><span style="display:flex;"><span>          iv_table_name   <span style="color:#f92672">=</span> lv_tab
</span></span><span style="display:flex;"><span>          it_table        <span style="color:#f92672">=</span> lt_ctab ).
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">ENDDO</span>.
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">&#34;jeÅ›li wszystko poszÅ‚o ok, wyÅ›wietl komunikat o bÅ‚Ä™dzie
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">MESSAGE</span> <span style="color:#e6db74">&#39;Processing succesfull&#39;</span> TYPE <span style="color:#e6db74">&#39;S&#39;</span>.
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">ENDMETHOD</span>.
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">METHOD</span> <span style="color:#a6e22e">get_ov_path</span>.
</span></span><span style="display:flex;"><span>    r_result <span style="color:#f92672">=</span> me<span style="color:#f92672">-&gt;</span>ov_path.
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">ENDMETHOD</span>.
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">METHOD</span> <span style="color:#a6e22e">set_ov_path</span>.
</span></span><span style="display:flex;"><span>    me<span style="color:#f92672">-&gt;</span>ov_path <span style="color:#f92672">=</span> iv_ov_path.
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">ENDMETHOD</span>.
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ENDCLASS</span>.</span></span></code></pre></div>
<h1 id="raport-uruchamiajÄ…cy-przetwaÅ¼anie">Raport uruchamiajÄ…cy przetwaÅ¼anie<a hidden class="anchor" aria-hidden="true" href="#raport-uruchamiajÄ…cy-przetwaÅ¼anie">#</a></h1>
<p>Finalnie moÅ¼emy przejÅ›Ä‡ do stworzenia raportu ktÃ³ry bÄ™dzie odpowiedzialny za uruchamianie naszej implementacji:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-abap" data-lang="abap"><span style="display:flex;"><span><span style="color:#66d9ef">REPORT</span> zload_data.
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">PARAMETERS</span>:
</span></span><span style="display:flex;"><span>  pa_path <span style="color:#66d9ef">TYPE </span>dxfields<span style="color:#f92672">-</span>longpath <span style="color:#66d9ef">LOWER CASE</span>,
</span></span><span style="display:flex;"><span>  pa_sapp <span style="color:#66d9ef">RADIOBUTTON GROUP</span> rb1 USER<span style="color:#f92672">-</span>COMMAND gr1 <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;X&#39;</span>,
</span></span><span style="display:flex;"><span>  pa_sagu <span style="color:#66d9ef">RADIOBUTTON GROUP</span> rb1.
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#75715e">&#34;ObsÅ‚uga evetu ktÃ³ry umoÅ¼liwia nam wyÅ›wietlenie menu z pomocÄ… we wprowadzeniu
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">&#34;Å›ciezki do parametru path
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">AT SELECTION-SCREEN ON VALUE-REQUEST FOR</span> pa_path.
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">DATA</span>(lv_loc) <span style="color:#f92672">=</span> SWITCH dxfields<span style="color:#f92672">-</span>location( pa_sapp
</span></span><span style="display:flex;"><span>                                           <span style="color:#66d9ef">WHEN</span> abap_true THEN <span style="color:#e6db74">&#39;A&#39;</span>
</span></span><span style="display:flex;"><span>                                           <span style="color:#66d9ef">WHEN</span> abap_false THEN <span style="color:#e6db74">&#39;P&#39;</span> ).
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">CALL FUNCTION</span> <span style="color:#e6db74">&#39;F4_DXFILENAME_TOPRECURSION&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">EXPORTING</span>
</span></span><span style="display:flex;"><span>      i_location_flag <span style="color:#f92672">=</span> lv_loc
</span></span><span style="display:flex;"><span>      i_path          <span style="color:#f92672">=</span> pa_path
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">IMPORTING</span>
</span></span><span style="display:flex;"><span>      o_path          <span style="color:#f92672">=</span> pa_path
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">EXCEPTIONS</span>
</span></span><span style="display:flex;"><span>      rfc_error       <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>      error_with_gui  <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">OTHERS</span>          <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>.
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">IF</span> sy<span style="color:#f92672">-</span>subrc <span style="color:#f92672">&amp;</span><span style="color:#f92672">lt</span>;<span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>.
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">MESSAGE</span> <span style="color:#66d9ef">ID</span> sy<span style="color:#f92672">-</span>msgid <span style="color:#66d9ef">TYPE </span>sy<span style="color:#f92672">-</span>msgty <span style="color:#66d9ef">NUMBER</span> sy<span style="color:#f92672">-</span>msgno
</span></span><span style="display:flex;"><span>               <span style="color:#66d9ef">WITH</span> sy<span style="color:#f92672">-</span>msgv1 sy<span style="color:#f92672">-</span>msgv2 sy<span style="color:#f92672">-</span>msgv3 sy<span style="color:#f92672">-</span>msgv4.
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">ENDIF</span>.
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">AT SELECTION-SCREEN</span>.
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">IF</span> sy<span style="color:#f92672">-</span>ucomm <span style="color:#f92672">&amp;</span><span style="color:#f92672">lt</span>;<span style="color:#f92672">&gt;</span> <span style="color:#e6db74">&#39;GR1&#39;</span> <span style="color:#f92672">AND</span> pa_path <span style="color:#f92672">IS INITIAL</span>.
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">MESSAGE</span> <span style="color:#e6db74">&#39;File path is required&#39;</span> TYPE <span style="color:#e6db74">&#39;E&#39;</span>.
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">ENDIF</span>.
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">START-OF-SELECTION</span>.
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">DATA</span>: lt_tab <span style="color:#66d9ef">TYPE  </span>zcl_file<span style="color:#f92672">=&gt;</span>tt_string_tab.
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">IF</span> pa_sagu <span style="color:#f92672">=</span> abap_true.
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">&#34;tworzymy nowy obiekt
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">DATA</span>(lobj_app_server) <span style="color:#f92672">=</span> NEW zcl_file_gui( ).
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">&#34;chcemy znaÄ‡ powÃ³d dla ktÃ³rego nie moÅ¼emy zauploadowaÄ‡ pliku
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">&#34;z GUI, dlatego EXCEPTIONS sÄ… odkomentowane w caÅ‚oÅ›ci
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    cl_gui_frontend_services<span style="color:#f92672">=&gt;</span><span style="color:#a6e22e">gui_upload</span>(
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">EXPORTING</span>
</span></span><span style="display:flex;"><span>    filename                <span style="color:#f92672">=</span> CONV <span style="color:#960050;background-color:#1e0010">#</span>( pa_path )
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">CHANGING</span>
</span></span><span style="display:flex;"><span>    data_tab                <span style="color:#f92672">=</span>  lt_tab
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">EXCEPTIONS</span>
</span></span><span style="display:flex;"><span>    file_open_error         <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    file_read_error         <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>    no_batch                <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>    gui_refuse_filetransfer <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>    invalid_type            <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>    no_authority            <span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span>    unknown_error           <span style="color:#f92672">=</span> <span style="color:#ae81ff">7</span>
</span></span><span style="display:flex;"><span>    bad_data_format         <span style="color:#f92672">=</span> <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>    header_not_allowed      <span style="color:#f92672">=</span> <span style="color:#ae81ff">9</span>
</span></span><span style="display:flex;"><span>    separator_not_allowed   <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>    header_too_long         <span style="color:#f92672">=</span> <span style="color:#ae81ff">11</span>
</span></span><span style="display:flex;"><span>    unknown_dp_error        <span style="color:#f92672">=</span> <span style="color:#ae81ff">12</span>
</span></span><span style="display:flex;"><span>    access_denied           <span style="color:#f92672">=</span> <span style="color:#ae81ff">13</span>
</span></span><span style="display:flex;"><span>    dp_out_of_memory        <span style="color:#f92672">=</span> <span style="color:#ae81ff">14</span>
</span></span><span style="display:flex;"><span>    disk_full               <span style="color:#f92672">=</span> <span style="color:#ae81ff">15</span>
</span></span><span style="display:flex;"><span>    dp_timeout              <span style="color:#f92672">=</span> <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>    not_supported_by_gui    <span style="color:#f92672">=</span> <span style="color:#ae81ff">17</span>
</span></span><span style="display:flex;"><span>    error_no_gui            <span style="color:#f92672">=</span> <span style="color:#ae81ff">18</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">OTHERS</span>                  <span style="color:#f92672">=</span> <span style="color:#ae81ff">19</span> ).
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">IF</span> sy<span style="color:#f92672">-</span>subrc <span style="color:#f92672">&amp;</span><span style="color:#f92672">lt</span>;<span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>.
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">MESSAGE</span> <span style="color:#66d9ef">ID</span> sy<span style="color:#f92672">-</span>msgid <span style="color:#66d9ef">TYPE </span>sy<span style="color:#f92672">-</span>msgty <span style="color:#66d9ef">NUMBER</span> sy<span style="color:#f92672">-</span>msgno
</span></span><span style="display:flex;"><span>                 <span style="color:#66d9ef">WITH</span> sy<span style="color:#f92672">-</span>msgv1 sy<span style="color:#f92672">-</span>msgv2 sy<span style="color:#f92672">-</span>msgv3 sy<span style="color:#f92672">-</span>msgv4.
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">ENDIF</span>.
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">&#34;uruchamiamy metodÄ™ process_gui_data i przekazuemy dane wczytane z GUI
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    lobj_app_server<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">process_gui_data</span>( lt_table <span style="color:#f92672">=</span> lt_tab  ).
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">ELSE</span>.
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">&#34;tworzymy obiekt i przekazujemy wymagne dane do konstruktora
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">DATA</span>(lobj_file_server) <span style="color:#f92672">=</span> NEW zcl_file_server( iv_path <span style="color:#f92672">=</span> CONV <span style="color:#960050;background-color:#1e0010">#</span>( pa_path ) ).
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">&#34;uruchamiamy metodÄ™ do przetwarzania danych z serwera apikacji
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    lobj_file_server<span style="color:#f92672">-&gt;</span><span style="color:#a6e22e">process_server_data</span>( ).
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">ENDIF</span>.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> </span></span></code></pre></div>
<p>Text elementy do raportu powinny wyglÄ…daÄ‡ nastÄ™pujÄ…co:</p>
<figure class="align-center ">
    <img loading="lazy" src="/dzialania_na_plikach/8a.png#center" width="70%"/> 
</figure>

<p>Finalnie powinniÅ›my mieÄ‡ trzy nowe klasy i raport oraz dwie tabele i plik widoczny w al11:</p>
<figure class="align-center ">
    <img loading="lazy" src="/dzialania_na_plikach/9.gif#center" width="70%"/> 
</figure>

<p>Przed uruchomieniem programu tabele powinny byÄ‡ puste, natomiast po jego uruchomieniu powinny wypeÅ‚niÄ‡ siÄ™ danymi:</p>
<figure class="align-center ">
    <img loading="lazy" src="/dzialania_na_plikach/10.gif#center" width="70%"/> 
</figure>

<p>W tej lekcji to juÅ¼ wszystko. JeÅ›li plik przeprocesowaÅ‚ siÄ™ poprawnie, wpisy w obu tabelach powinny pojawiÄ‡ siÄ™ natychmiast po uruchomieniu. Pliki utworzone podczas tej lekcji moÅ¼ecie znaleÅºÄ‡ teÅ¼ na githubie:</p>
<p><a href="https://github.com/pawelwiejkut/abap_operacje_na_plikach.git">https://github.com/pawelwiejkut/abap_operacje_na_plikach.git</a></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:56746/tags/abap/">ABAP</a></li>
      <li><a href="http://localhost:56746/tags/abap-od-podstaw/">ABAP Od Podstaw</a></li>
    </ul>
  </footer>
<link href="//cdn-images.mailchimp.com/embedcode/horizontal-slim-10_7.css" rel="stylesheet" type="text/css">
<div id="mc_embed_signup">
<form action="https://pawelwiejkut.us19.list-manage.com/subscribe/post?u=ead4e0dc04f1f8c07403a39ac&amp;id=500c9c1881" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
	<label for="mce-EMAIL">Subscribe for newsletter:</label>
	<input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
    
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_ead4e0dc04f1f8c07403a39ac_500c9c1881" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
</form>
</div>



<script src="https://utteranc.es/client.js"
        repo="pawelwiejkut/pawelwiejkut.dev"
        issue-term="pathname"
        label="comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>

</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="http://localhost:56746/">Pawel Wiejkut</a></span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
